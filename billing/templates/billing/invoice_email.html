<!-- billing/invoice_email.html -->
<html>
  <body>
    <h2>Invoice #{{ purchase.id }}</h2>
    <p>Dear Customer,</p>
    <p>Thank you for your purchase. Please find your invoice details below.</p>

    <table border="1" cellpadding="6" cellspacing="0">
      <thead>
        <tr>
          <th>Product ID</th>
          <th>Product Name</th>
          <th>Unit Price</th>
          <th>Qty</th>
          <th>Subtotal</th>
          <th>Tax%</th>
          <th>Tax Amount</th>
          <th>Line Total</th>
        </tr>
      </thead>
      <tbody>
        {% for item in purchase.items.all %}
        <tr>
          <td>{{ item.product.product_id }}</td>
          <td>{{ item.product.name }}</td>
          <td>{{ item.unit_price }}</td>
          <td>{{ item.quantity }}</td>
          <td>{{ item.line_subtotal }}</td>
          <td>{{ item.tax_percentage }}</td>
          <td>{{ item.line_tax_amount }}</td>
          <td>{{ item.line_total }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <p><strong>Subtotal:</strong> ₹{{ purchase.subtotal }}</p>
    <p><strong>Tax Total:</strong> ₹{{ purchase.tax_total }}</p>
    <p><strong>Grand Total:</strong> ₹{{ purchase.total }}</p>
    <p><strong>Paid Amount:</strong> ₹{{ purchase.paid_amount }}</p>
    <p><strong>Balance:</strong> ₹{{ purchase.balance }}</p>

    {% if purchase.balance > 0 %}
    <h4>Balance Denominations:</h4>
    <ul>
      {% for c in purchase.change_denominations.all %}
      <li>₹{{ c.denomination_value }} x {{ c.count_given }}</li>
      {% endfor %}
    </ul>
    {% endif %}

    <p>Regards,<br/>Your Shop</p>
  </body>
</html>